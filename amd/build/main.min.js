define(["jquery","core/sortable_list","core/notification","core/custom_interaction_events","core/ajax","core/log"],function(a,b,c,d,e,f){var g={SECTION_CONTAINER:'[data-region="section-container"]',SECTION:'[data-region="section"]',MODULES_CONTAINER:'[data-region="course-modules"]',MODULE:'[data-region="module"]',COMPLETIONCHECKS:'[data-region="completioncheck"]',COMPLETION_ON:'[data-region="checkon"]',COMPLETION_OFF:'[data-region="checkoff"]',EXPAND_SECTIONS:'[data-action="expand"]',EXPAND_SECTIONS_OPEN:'[data-region="collapsed-open"]',EXPAND_SECTIONS_CLOSED:'[data-region="collapsed-closed"]',COMPLETION_CONTAINER:'[data-actions="availability"]',COMPLETION_INFO:'[data-region="availabilityinfo"]'},h=function(a){var b={methodname:"format_wplist_move_section",args:a},d=e.call([b])[0];return d.fail(c.exception),d},i=function(a){var b={methodname:"format_wplist_move_module",args:a},d=e.call([b])[0];return d.fail(c.exception),d},j=function(a){var b={methodname:"format_wplist_module_completion",args:a},d=e.call([b])[0];return d.fail(c.exception),d},k=function(a,b){0==b?(a.attr("data-checked",1),a.attr("data-targetstate",0),a.find(g.COMPLETION_ON).removeClass("hidden"),a.find(g.COMPLETION_OFF).addClass("hidden")):(a.attr("data-checked",0),a.attr("data-targetstate",1),a.find(g.COMPLETION_ON).addClass("hidden"),a.find(g.COMPLETION_OFF).removeClass("hidden"))},l=function(a,b,c){var d=a.find("#sectionprogress-"+b),e=d.attr("data-completed-modules"),g=d.attr("data-completion-modules");1==c?e++:e--,d.attr("data-completed-modules",e);var h=100*(e/g);f.debug("hello",e),d.css("width",h+"%")},m=function(e){d.define(e,[d.events.activate]),e.on(d.events.activate,g.EXPAND_SECTIONS,function(b){var c=a(b.target).closest(g.EXPAND_SECTIONS),d=c.find(g.EXPAND_SECTIONS_OPEN),e=c.find(g.EXPAND_SECTIONS_CLOSED),f=c.attr("data-expended");0==f?(a('[data-region="sectioncollapse"]').each(function(){a(this).addClass("show")}),d.removeClass("hidden"),e.addClass("hidden"),c.attr("data-expended",1)):(a('[data-region="sectioncollapse"]').each(function(){a(this).removeClass("show")}),d.addClass("hidden"),e.removeClass("hidden"),c.attr("data-expended",0))}),e.on(d.events.activate,g.COMPLETIONCHECKS,function(b){var c=a(b.target).closest(g.COMPLETIONCHECKS),d=c.attr("data-module"),f=c.attr("data-targetstate"),h=c.attr("data-courseid"),i=c.attr("data-checked"),m=c.attr("data-sectionid"),n={moduleid:d,targetstate:f,courseid:h};j(n).then(function(){k(c,i),l(e,m,f)})});var m=e.find(g.SECTION_CONTAINER),n=e.find(g.SECTION),o=m.attr("data-courseid");new b(m);var p=e.find(g.MODULES_CONTAINER);new b(p),n.on(b.EVENTS.DROP,function(a,b){if(b.positionChanged){if(b.element.attr("data-section")){var d=b.element.attr("data-section"),e=b.targetNextElement.attr("data-section"),g={sectionid:d,sectiontarget:e,courseid:o};h(g).then(function(a){b.element.attr("data-section",e),b.targetNextElement.attr("data-section",d),f.debug(a)})["catch"](c.exception)}if(b.element.attr("data-module")){var j=b.element.attr("data-module"),k=b.targetNextElement.attr("data-module"),d=b.targetNextElement.attr("data-module-section"),g={moduleid:j,moduletarget:k,sectionid:d,courseid:o};i(g).then(function(a){b.element.attr("data-module",k),b.targetNextElement.attr("data-module",j),f.debug(a)})["catch"](c.exception)}}})},n=function(b){b=a(b),m(b)};return{init:n}});