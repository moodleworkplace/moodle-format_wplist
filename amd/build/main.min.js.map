{"version":3,"sources":["../src/main.js"],"names":["define","$","Sortablewplist","Notification","CustomEvents","Ajax","Str","Templates","SELECTORS","SECTION_CONTAINER","SECTION","MODULES_CONTAINER","MODULE","COMPLETIONCHECKS","EXPAND_TOGGLE","EXPAND_SECTIONS","EXPAND_SECTIONS_OPEN","EXPAND_SECTIONS_CLOSED","EXPAND_SECTIONS_CONTENT","COMPLETION_CONTAINER","COMPLETION_INFO","moveSection","args","promise","call","methodname","fail","exception","moveModule","checkCompletion","updateSectionCompletion","root","sectionnumber","targetstate","sectionprogress","find","completedmodules","attr","completionmodules","newCompletionPercentage","get_string","done","s","css","updateSectionCollapse","open","auto","length","expand","openmsg","closedmsg","removeClass","addClass","registerEventListeners","contextid","events","activate","on","e","parseInt","target","closest","each","storeSectionPreference","sectionid","data","isaccordion","sectionname","cc","moduleid","courseid","reloadOnChange","then","html","window","location","reload","replaceNode","completionicon","sectionsContainer","sections","getSectionName","element","text","getModuleName","findClosestSection","sectionsSortable","moveHandlerSelector","getElementName","Deferred","resolve","modulesContainers","modulesSortable","getDestinationName","parentElement","afterElement","EVENTS","DROP","info","stopPropagation","positionChanged","targetNextElement","moveElement","sourceList","sourceNextElement","sectiontarget","catch","moduletarget","targetList","countmodules","modulesContainer","nummodules","children","DRAG","oldSectionModules","numoldmodules","newSection","DRAGEND","opened","name","p","push","preferences","value","JSON","parse","index","indexOf","splice","requestset","type","stringify","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for course format workplace list.\n *\n * @package    format_wplist\n * @copyright  2019 Moodle Pty Ltd <support@moodle.com>\n * @author     2019 <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @license    Moodle Workplace License, distribution is restricted, contact support@moodle.com\n */\n\ndefine(\n[\n    'jquery',\n    'core/sortable_list',\n    'core/notification',\n    'core/custom_interaction_events',\n    'core/ajax',\n    'core/str',\n    'core/templates'\n],\nfunction(\n    $,\n    Sortablewplist,\n    Notification,\n    CustomEvents,\n    Ajax,\n    Str,\n    Templates\n) {\n\n    var SELECTORS = {\n        SECTION_CONTAINER: '[data-region=\"section-container\"]',\n        SECTION: '[data-region=\"section\"]',\n        MODULES_CONTAINER: '[data-region=\"course-modules\"]',\n        MODULE: '[data-region=\"module\"]',\n        COMPLETIONCHECKS: '[data-region=\"completioncheck\"]',\n        EXPAND_TOGGLE: '[data-toggle=\"collapse\"]',\n        EXPAND_SECTIONS: '[data-action=\"expand\"]',\n        EXPAND_SECTIONS_OPEN: '[data-region=\"collapsed-open\"]',\n        EXPAND_SECTIONS_CLOSED: '[data-region=\"collapsed-closed\"]',\n        EXPAND_SECTIONS_CONTENT: '[data-region=\"sectioncollapse\"]',\n        COMPLETION_CONTAINER: '[data-actions=\"availability\"]',\n        COMPLETION_INFO: '[data-region=\"availabilityinfo\"]'\n\n    };\n\n    /**\n     * Move a course section.\n     *\n     * @param {Object} args Arguments to pass to webservice\n     *\n     * Valid args are:t\n     * int sectionnumber number of section to move\n     * int sectiontarget number of section to position after\n     * int courseid.     id of course this module belongs to\n     *\n     * @return {promise} Resolved with void or array of warnings\n     */\n    var moveSection = function(args) {\n        var request = {\n            methodname: 'format_wplist_move_section',\n            args: args\n        };\n        var promise = Ajax.call([request])[0];\n        promise.fail(Notification.exception);\n        return promise;\n    };\n\n    /**\n     * Move a course module.\n     *\n     * @param {Object} args Arguments to pass to webservice\n     *\n     * Valid args are:t\n     * int moduleid      id of module to move\n     * int moduletarget  id of module to position after\n     * int sectionnumber number of section to move module to\n     * int courseid.     id of course this section belongs to\n     *\n     * @return {promise} Resolved with void or array of warnings\n     */\n    var moveModule = function(args) {\n        var request = {\n            methodname: 'format_wplist_move_module',\n            args: args\n        };\n        var promise = Ajax.call([request])[0];\n        promise.fail(Notification.exception);\n        return promise;\n    };\n\n    /**\n     * Check the completion checkbox for self-completion.\n     *\n     * @param {Object} args Arguments to pass to webservice\n     *\n     * Valid args are:t\n     * int moduleid      id of module to complet\n     * int targetstate   set completion to on (1) or off (0)\n     *\n     * @return {promise} Resolved with void or array of warnings\n     */\n    var checkCompletion = function(args) {\n        var request = {\n            methodname: 'format_wplist_module_completion',\n            args: args\n        };\n        var promise = Ajax.call([request])[0];\n        promise.fail(Notification.exception);\n        return promise;\n    };\n\n    /**\n     * Update the section completion progress bar.\n     *\n     * @param {Object} root The course format root container element.\n     * @param {Number} sectionnumber Section ID.\n     * @param {Number} targetstate New state.\n     */\n    var updateSectionCompletion = function(root, sectionnumber, targetstate) {\n        var sectionprogress = root.find('#sectionprogress-' + sectionnumber);\n        var completedmodules = sectionprogress.attr('data-completed-modules');\n        var completionmodules = sectionprogress.attr('data-completion-modules');\n        if (targetstate === 1) {\n            completedmodules++;\n        } else {\n            completedmodules--;\n        }\n        var newCompletionPercentage = 100 * (completedmodules / completionmodules);\n        Str.get_string('section_completion', 'format_wplist', newCompletionPercentage).done(function(s) {\n            sectionprogress.attr('title', s);\n            sectionprogress.attr('data-completed-modules', completedmodules);\n            sectionprogress.css('width', newCompletionPercentage + '%');\n        });\n    };\n\n    /**\n     * Update the section collapse button.\n     * @param  {Object} root The course format root container element.\n     * @param  {Number} open Show state for all containers open.\n     * @param  {Bool} auto Check if containers open.\n     * @return {Bool} return early if auto and not all sections closed or open.\n     */\n    var updateSectionCollapse = function(root, open, auto) {\n        if (auto) {\n            if (root.find('.sectioncontent.collapse.show').length === 0) {\n                open = 1;\n            } else if (root.find('.sectioncontent.collapse:not(.show)').length === 0) {\n                open = 0;\n            } else {\n                // Return early since not all sections are open or closed.\n                return false;\n            }\n        }\n\n        var expand = root.find(SELECTORS.EXPAND_SECTIONS);\n        var openmsg = expand.find(SELECTORS.EXPAND_SECTIONS_OPEN);\n        var closedmsg = expand.find(SELECTORS.EXPAND_SECTIONS_CLOSED);\n        if (open === 0) {\n            openmsg.removeClass('hidden');\n            closedmsg.addClass('hidden');\n            expand.attr('data-expanded', 1);\n        } else {\n            openmsg.addClass('hidden');\n            closedmsg.removeClass('hidden');\n            expand.attr('data-expanded', 0);\n        }\n        return true;\n    };\n\n    /**\n     * Listen to, and handle events for the workplace list format.\n     *\n     * @param {Object} root The course format root container element.\n     * @param {Number} contextid Course context ID.\n     */\n    var registerEventListeners = function(root, contextid) {\n        CustomEvents.define(root, [\n            CustomEvents.events.activate\n        ]);\n\n        root.on(CustomEvents.events.activate, SELECTORS.EXPAND_SECTIONS, function(e) {\n            var open = parseInt($(e.target).closest(SELECTORS.EXPAND_SECTIONS).attr('data-expanded'));\n            if (open === 0) {\n                $(SELECTORS.EXPAND_SECTIONS_CONTENT).each(function() {\n                    $(this).addClass('show');\n                });\n                $(SELECTORS.EXPAND_TOGGLE).each(function() {\n                    $(this).removeClass('collapsed');\n                });\n                updateSectionCollapse(root, 0, false);\n                storeSectionPreference(root, 0, true, true, contextid);\n            } else {\n                $(SELECTORS.EXPAND_SECTIONS_CONTENT).each(function() {\n                    $(this).removeClass('show');\n                });\n                $(SELECTORS.EXPAND_TOGGLE).each(function() {\n                    $(this).addClass('collapsed');\n                });\n                updateSectionCollapse(root, 1, false);\n                storeSectionPreference(root, 0, true, false, contextid);\n            }\n        });\n\n        $(SELECTORS.EXPAND_SECTIONS_CONTENT).on('hidden.bs.collapse', function() {\n            var sectionid = $(this).data('sectionid');\n            var sectionnumber = $(this).data('sectionnumber');\n            var isaccordion = $(this).data('isaccordion');\n            var sectionname = $(this).data('sectionname');\n            updateSectionCollapse(root, 1, true);\n            Str.get_string('expandsection', 'format_wplist', sectionname).done(function(s) {\n                $('.course-section-toggle[data-target=\"#sectioncontent-' + sectionnumber + '\"]').attr('title', s);\n                storeSectionPreference(root, sectionid, isaccordion, false, contextid);\n            });\n        });\n\n        $(SELECTORS.EXPAND_SECTIONS_CONTENT).on('shown.bs.collapse', function() {\n            var sectionid = $(this).data('sectionid');\n            var sectionnumber = $(this).data('sectionnumber');\n            var isaccordion = $(this).data('isaccordion');\n            var sectionname = $(this).data('sectionname');\n            updateSectionCollapse(root, 0, true);\n            Str.get_string('collapsesection', 'format_wplist', sectionname).done(function(s) {\n                $('.course-section-toggle[data-target=\"#sectioncontent-' + sectionnumber + '\"]').attr('title', s);\n                storeSectionPreference(root, sectionid, isaccordion, true, contextid);\n            });\n        });\n\n        // Listen for changes on completion.\n        root.on(CustomEvents.events.activate, SELECTORS.COMPLETIONCHECKS, function(e) {\n            var cc = $(e.target).closest(SELECTORS.COMPLETIONCHECKS);\n            var moduleid = parseInt(cc.attr('data-module'));\n            var targetstate = parseInt(cc.attr('data-targetstate'));\n            var courseid = parseInt(cc.attr('data-courseid'));\n            var sectionnumber = parseInt(cc.attr('data-sectionnumber'));\n            var reloadOnChange = parseInt(cc.attr('data-reloadonchange'));\n\n            var args = {\n                moduleid: moduleid,\n                targetstate: targetstate,\n                courseid: courseid\n            };\n\n            checkCompletion(args).then(function(html) {\n                if (reloadOnChange) {\n                    window.location.reload();\n                }\n                updateSectionCompletion(root, sectionnumber, targetstate);\n                Templates.replaceNode(cc, html.completionicon, '');\n                return null;\n            })\n            .fail(Notification.exception);\n        });\n\n        // Variables for moving sections.\n        var sectionsContainer = root.find(SELECTORS.SECTION_CONTAINER);\n\n        var sections = root.find(SELECTORS.SECTION);\n\n        var courseid = sectionsContainer.attr('data-courseid');\n\n        var getSectionName = function(element) {\n            return element.find('h3.sectionname .inplaceeditable').text();\n        };\n        var getModuleName = function(element) {\n            return element.find('.cmname .inplaceeditable').text();\n        };\n        var findClosestSection = function(element) {\n            return element.closest('[data-region=\"section\"][data-sectionnumber]');\n        };\n\n        var sectionsSortable = new Sortablewplist(sectionsContainer, {moveHandlerSelector: '.movesection > [data-drag-type=move]'});\n        sectionsSortable.getElementName = function(element) {\n            return $.Deferred().resolve(getSectionName(element));\n        };\n\n        // Variables for moving modules.\n        var modulesContainers = root.find(SELECTORS.MODULES_CONTAINER);\n\n        var modulesSortable = new Sortablewplist(modulesContainers, {moveHandlerSelector: '.movemodule > [data-drag-type=move]'});\n        modulesSortable.getElementName = function(element) {\n            return $.Deferred().resolve(getModuleName(element));\n        };\n        modulesSortable.getDestinationName = function(parentElement, afterElement) {\n            if (!afterElement.length) {\n                return Str.get_string('totopofsection', 'moodle',\n                        getSectionName(findClosestSection(parentElement)));\n            } else {\n                // We check that is not the empty section message.\n                if ($(afterElement).find('.cmname').length === 0) {\n                    return null;\n                } else {\n                    return Str.get_string('movecontentafter', 'moodle', getModuleName(afterElement));\n                }\n            }\n        };\n\n        sections.on(Sortablewplist.EVENTS.DROP, function(e, info) {\n            e.stopPropagation();\n            var sectionnumber,\n                args;\n            if (info.positionChanged) {\n                if (info.element.attr('data-sectionnumber')) {\n                    if (info.targetNextElement && info.targetNextElement.attr('data-sectionnumber') === \"0\") {\n                        // Can not move before general section.\n                        sectionsSortable.moveElement(info.sourceList, info.sourceNextElement);\n                        return;\n                    }\n                    sectionnumber = info.element.attr('data-sectionnumber');\n                    var sectiontarget = info.targetNextElement.attr('data-sectionnumber');\n                    args = {\n                        sectionnumber: sectionnumber,\n                        sectiontarget: sectiontarget,\n                        courseid: courseid\n                    };\n                    moveSection(args).then(function() {\n                        info.element.attr('data-sectionnumber', sectiontarget);\n                        info.targetNextElement.attr('data-sectionnumber', sectionnumber);\n                        return null;\n                    }).catch(Notification.exception);\n                }\n                if (info.element.attr('data-module')) {\n                    var moduleid = info.element.attr('data-module');\n                    var moduletarget = info.targetNextElement.attr('data-module');\n                    sectionnumber = findClosestSection(info.targetList).attr('data-sectionnumber');\n                    args = {\n                        moduleid: moduleid,\n                        moduletarget: moduletarget,\n                        sectionnumber: sectionnumber,\n                        courseid: courseid\n                    };\n                    if (typeof moduleid !== 'undefined' && moduleid !== 0) {\n                        moveModule(args).catch(Notification.exception);\n                    }\n                }\n            }\n        });\n\n        // Count the number of modules in each Modules container.\n        var countmodules = function() {\n            root.find(SELECTORS.SECTION).each(function() {\n                var modulesContainer = $(this).find(SELECTORS.MODULES_CONTAINER);\n                var nummodules = modulesContainer.children().length - 1;\n\n                modulesContainer.attr('data-nummodules', nummodules);\n\n                if (nummodules === 0) {\n                    modulesContainer.addClass('nomodules');\n                } else {\n                    modulesContainer.removeClass('nomodules');\n                }\n            });\n        };\n\n        countmodules();\n\n        sections.on(Sortablewplist.EVENTS.DRAG, function(e, info) {\n            if (info.element.attr('data-module')) {\n                root.find(SELECTORS.SECTION).each(function() {\n                    $(this).removeClass('movemodule');\n                });\n\n                var oldSectionModules = findClosestSection(info.sourceList).find(SELECTORS.MODULES_CONTAINER);\n                var numoldmodules = parseInt(oldSectionModules.attr('data-nummodules'));\n                if (numoldmodules === 1) {\n                    oldSectionModules.addClass('nomodules');\n                }\n\n                var newSection = findClosestSection(info.targetList);\n                newSection.addClass('movemodule');\n            }\n        });\n\n        sections.on(Sortablewplist.EVENTS.DRAGEND, function(e, info) {\n            if (info.element.attr('data-module')) {\n                countmodules();\n            }\n        });\n    };\n\n    /**\n     * Store the user display preference for this section\n     *\n     * @param {Object} root The course format root container element.\n     * @param {Number} sectionid Section ID.\n     * @param {Boolean} isaccordion\n     * @param {Boolean} opened = true or closed = false.\n     * @param {Number} contextid Course context ID.\n     */\n    var storeSectionPreference = function(root, sectionid, isaccordion, opened, contextid) {\n\n        var requestget = {\n            methodname: 'core_user_get_user_preferences',\n            args: {\n                name: 'format_wplist_opensections_' + contextid\n            }\n        };\n\n        var sections = [];\n\n        Ajax.call([requestget])[0]\n            .then(function(p) {\n                if (sectionid === 0 && opened) {\n                    sections = [];\n                    root.find('.sectioncontent.collapse').each(function() {\n                        var sectionid = $(this).data('sectionid');\n                        sections.push(sectionid);\n                    });\n                } else if (isaccordion) {\n                    if (opened) {\n                        sections = [sectionid];\n                    } else {\n                        sections = [];\n                    }\n                } else {\n                    if (p.preferences.length && p.preferences[0].value) {\n                        sections = JSON.parse(p.preferences[0].value);\n                    }\n                    var index = sections.indexOf(sectionid);\n                    if (opened) {\n                        if (index === -1) {\n                            sections.push(sectionid);\n                        }\n                    } else {\n                        if (index > -1) {\n                            sections.splice(index, 1);\n                        }\n                    }\n                }\n                var requestset = {\n                    methodname: 'core_user_update_user_preferences',\n                    args: {\n                        preferences: [{\n                            type: 'format_wplist_opensections_' + contextid,\n                            value: JSON.stringify(sections)\n                        }]\n                    }\n                };\n                return Ajax.call([requestset])[0];\n            })\n        .fail(Notification.exception);\n    };\n\n    /**\n     * Initialise all of the modules for the workplace list course format.\n     *\n     * @param {object} root The root element for the workplace list course format.\n     * @param {Number} contextid Course context ID.\n     */\n    var init = function(root, contextid) {\n        root = $(root);\n        registerEventListeners(root, contextid);\n    };\n\n    return {\n        init: init\n    };\n});\n"],"file":"main.min.js"}